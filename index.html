<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>News Feed (CSV)</title>
  <meta name="description" content="Lightweight news feed that reads a CSV and renders cards. 100% free, static-only.">
  <!-- Minimal CSS (no frameworks) -->
  <style>
    :root{
      --bg:#0f172a; /* slate-900 */
      --card:#111827; /* gray-900 */
      --muted:#9ca3af; /* gray-400 */
      --text:#e5e7eb; /* gray-200 */
      --accent:#22d3ee; /* cyan-400 */
      --accent-2:#a78bfa; /* violet-400 */
    }
    *{box-sizing:border-box}
    body{margin:0;background:linear-gradient(180deg,#0b1224,#0f172a);color:var(--text);font:16px/1.5 system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial}
    .container{max-width:1100px;margin:0 auto;padding:32px 16px}
    header{display:flex;flex-wrap:wrap;gap:12px;align-items:center;justify-content:space-between;margin-bottom:16px}
    h1{font-size:clamp(20px,3vw,28px);margin:0}
    .controls{display:flex;flex-wrap:wrap;gap:8px}
    input[type="search"], select, button, .tag{border:1px solid #1f2937;background:#0b1220;color:var(--text);padding:8px 10px;border-radius:10px}
    button{cursor:pointer}
    .tag{cursor:pointer;user-select:none}
    .tag.active{outline:2px solid var(--accent)}
    .grid{display:grid;grid-template-columns:repeat(12,1fr);gap:16px}
    .card{grid-column:span 12;background:linear-gradient(180deg,rgba(255,255,255,.03),rgba(255,255,255,.01));border:1px solid rgba(255,255,255,.06);border-radius:16px;padding:16px}
    @media (min-width:720px){.card{grid-column:span 6}}
    @media (min-width:1024px){.card{grid-column:span 4}}
    .title{font-weight:700;font-size:18px;margin:0 0 6px}
    .title a{color:#fff;text-decoration:none}
    .title a:hover{text-decoration:underline}
    .meta{font-size:13px;color:var(--muted);display:flex;gap:10px;flex-wrap:wrap}
    .pill{display:inline-flex;align-items:center;gap:6px;padding:2px 8px;border-radius:999px;border:1px solid rgba(255,255,255,.12);font-size:12px;color:#d1d5db}
    .desc{margin-top:10px;color:#dbeafe}
    .empty{opacity:.7;text-align:center;padding:32px}
    footer{margin-top:20px;color:var(--muted);font-size:12px;text-align:center}
  </style>
  <!-- Day.js for date parsing/formatting -->
  <script src="https://cdn.jsdelivr.net/npm/dayjs@1/dayjs.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/dayjs@1/plugin/customParseFormat.js"></script>
  <script>dayjs.extend(window.dayjs_plugin_customParseFormat)</script>
  <!-- PapaParse for CSV -->
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
</head>
<body>
  <div class="container">
    <header>
      <h1>News Feed (CSV)</h1>
      <div class="controls">
        <input id="search" type="search" placeholder="Search‚Ä¶ (title, outlet, summary)" />
        <select id="sort">
          <option value="newest">Newest first</option>
          <option value="oldest">Oldest first</option>
          <option value="az">Title A‚ÜíZ</option>
          <option value="za">Title Z‚ÜíA</option>
        </select>
        <button id="reload">Reload</button>
      </div>
    </header>

    <div class="controls" style="margin-bottom:12px">
      <span class="tag" data-tag="Nacional">Nacional</span>
      <span class="tag" data-tag="Internacional">Internacional</span>
      <!-- Add more quick-tags if you use other labels in your CSV -->
    </div>

    <main class="grid" id="grid"></main>
    <div id="empty" class="empty" hidden>No results found. Try clearing filters.</div>

    <footer>
      <div>Static site. Data loaded from a CSV file at runtime. Update the CSV and the feed updates automatically.</div>
    </footer>
  </div>

<script>
/**
 * HOW TO DEPLOY (100% FREE):
 * 1) Place this file (index.html) and your CSV (noticias.csv) in the same folder of a public GitHub repo.
 * 2) In GitHub ‚Üí Settings ‚Üí Pages ‚Üí set Build and deployment to main branch (/root). Copy the public URL.
 * 3) To update the feed, edit/add rows in noticias.csv and commit. The site will reflect changes on reload.
 *
 * If you must keep a different CSV filename or host (e.g., Google Sheets "Publish to web" ‚Üí CSV), just change CSV_URL below.
 * IMPORTANT: If you use SharePoint/OneDrive links, you may hit CORS/auth issues. The safest is keeping the CSV in the same repo.
 */

// === CONFIG ===
const CSV_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vRylZeZ-nRjTQy6KHzcJSp9Wo28KrLFfJKhORvj8_-5Kv1thY9SdjKuXfoXr24FzopqR34Xr-us-_fi/pub?gid=583607882&single=true&output=csv'; // default expects the CSV next to this HTML
const AUTO_REFRESH_MINUTES = 0; // set to >0 to auto-reload (e.g., 5)

// Optional: map common header aliases ‚Üí canonical keys we use internally
const HEADER_ALIASES = {
  date: ['data','date','published','publish_date','dia'],
  title: ['titulo','t√≠tulo','title','headline'],
  url: ['link','url','href'],
  outlet: ['veiculo','ve√≠culo','fonte','outlet','source','publisher'],
  summary: ['resumo','descricao','descri√ß√£o','summary','description'],
  tag: ['tag','tags','categoria','categoria(s)','label']
};

let RAW_ROWS = [];
let ACTIVE_TAGS = new Set();

const $grid = document.getElementById('grid');
const $empty = document.getElementById('empty');
const $search = document.getElementById('search');
const $sort = document.getElementById('sort');
const $reload = document.getElementById('reload');

// Tag toggles
for (const el of document.querySelectorAll('.tag')){
  el.addEventListener('click', () => {
    const t = el.dataset.tag;
    if (ACTIVE_TAGS.has(t)) { ACTIVE_TAGS.delete(t); el.classList.remove('active'); }
    else { ACTIVE_TAGS.add(t); el.classList.add('active'); }
    render();
  });
}

$search.addEventListener('input', () => render());
$sort.addEventListener('change', () => render());
$reload.addEventListener('click', () => fetchCSV(true));

if (AUTO_REFRESH_MINUTES > 0) {
  setInterval(() => fetchCSV(true), AUTO_REFRESH_MINUTES * 60 * 1000);
}

fetchCSV();

function fetchCSV(bustCache=false){
  const url = bustCache ? `${CSV_URL}?t=${Date.now()}` : CSV_URL;
  Papa.parse(url, {
    download: true,
    header: true,
    skipEmptyLines: true,
    complete: (res) => {
      RAW_ROWS = normalizeRows(res.data || []);
      render();
    },
    error: (err) => {
      console.error('CSV load error', err);
      $grid.innerHTML = '';
      $empty.hidden = false;
      $empty.textContent = 'Failed to load CSV. Make sure the file is public and next to this HTML.';
    }
  });
}

function normalizeRows(rows){
  // Build a key map from CSV headers to canonical keys
  const mapKey = (key) => {
    const k = (key||'').trim().toLowerCase();
    for (const canonical in HEADER_ALIASES){
      const list = HEADER_ALIASES[canonical];
      if (list.includes(k)) return canonical;
    }
    return k; // fallback to original
  };

  if (!rows.length) return [];
  const sample = rows[0];
  const keyMap = {};
  for (const k in sample){ keyMap[k] = mapKey(k); }

  return rows.map(r => {
    const obj = {};
    for (const k in r){ obj[keyMap[k]] = (r[k]||'').toString().trim(); }

    // Parse date in common formats; keep original if needed
    obj.dateParsed = parseDate(obj.date);

    // Normalize tags: split by comma/; and trim
    obj.tags = (obj.tag||'').split(/[,;|]/).map(s => s.trim()).filter(Boolean);

    return obj;
  });
}

function parseDate(v){
  if (!v) return null;
  const s = v.trim();
  const fmts = [
    'YYYY-MM-DD','DD/MM/YYYY','DD/MM/YY','MM/DD/YYYY','YYYY/MM/DD','D MMM YYYY','MMM D, YYYY','YYYY.MM.DD'
  ];
  for (const f of fmts){
    const d = dayjs(s, f, true);
    if (d.isValid()) return d;
  }
  // try native
  const d2 = dayjs(s);
  return d2.isValid() ? d2 : null;
}

function render(){
  const q = ($search.value||'').toLowerCase();

  let list = RAW_ROWS.filter(row => {
    // Tag filter
    if (ACTIVE_TAGS.size){
      if (!row.tags || !row.tags.some(t => ACTIVE_TAGS.has(t))) return false;
    }
    // Search filter
    if (q){
      const hay = [row.title,row.outlet,row.summary,row.tag].join(' ').toLowerCase();
      if (!hay.includes(q)) return false;
    }
    return true;
  });

  // Sort
  const s = $sort.value;
  list.sort((a,b) => {
    if (s === 'newest'){
      const ad = a.dateParsed ? a.dateParsed.valueOf() : 0;
      const bd = b.dateParsed ? b.dateParsed.valueOf() : 0;
      return bd - ad;
    }
    if (s === 'oldest'){
      const ad = a.dateParsed ? a.dateParsed.valueOf() : 0;
      const bd = b.dateParsed ? b.dateParsed.valueOf() : 0;
      return ad - bd;
    }
    if (s === 'az') return (a.title||'').localeCompare(b.title||'');
    if (s === 'za') return (b.title||'').localeCompare(a.title||'');
    return 0;
  });

  $grid.innerHTML = '';

  if (!list.length){
    $empty.hidden = false;
    return;
  }
  $empty.hidden = true;

  for (const row of list){
    const title = row.title || '(untitled)';
    const url = row.url || '#';
    const outlet = row.outlet || '';
    const dateStr = row.dateParsed ? row.dateParsed.format('DD/MM/YYYY') : (row.date || '');
    const summary = row.summary || '';
    const tags = row.tags || [];

    const card = document.createElement('article');
    card.className = 'card';
    card.innerHTML = `
      <h3 class="title"><a href="${escapeHTML(url)}" target="_blank" rel="noopener noreferrer">${escapeHTML(title)}</a></h3>
      <div class="meta">
        ${dateStr ? `<span class="pill">üóìÔ∏è ${escapeHTML(dateStr)}</span>` : ''}
        ${outlet ? `<span class="pill">üè∑Ô∏è ${escapeHTML(outlet)}</span>` : ''}
        ${tags.map(t => `<span class="pill">${escapeHTML(t)}</span>`).join('')}
      </div>
      ${summary ? `<p class="desc">${escapeHTML(summary)}</p>` : ''}
    `;
    $grid.appendChild(card);
  }
}

function escapeHTML(str){
  return (str||'').replace(/[&<>"']/g, s => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;','\'':'&#39;'}[s]));
}
</script>
</body>
</html>
